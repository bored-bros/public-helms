{{- $template := fromYaml (include "manifest.resource" .) -}}
{{- $labels := .Values.labels | default dict -}}
{{- $annotations := .Values.annotations | default dict -}}
{{- range .Values.resources }}
---
{{ toYaml (mergeOverwrite (dict "metadata" (dict "labels" $labels "annotations" $annotations)) (merge . $template)) -}}
{{- end }}
{{- range $i, $t := .Values.templates }}
---
{{ toYaml (mergeOverwrite (dict "metadata" (dict "labels" $labels "annotations" $annotations)) (merge (tpl $t $ | fromYaml) $template)) -}}
{{- end }}